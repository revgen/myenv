#!/bin/sh
export SMTP_SERVER=email-smtp.us-east-1.amazonaws.com
export SMTP_STARTTLS=true
export SMTP_USERNAME=
export SMTP_PASSWORD=
export SENDER="Robo <test@change.me>"
export RECEPIENT="Robo <test@change.me>"
export SUBJECT="${SUBJECT:-"[$(hostname)] Notification"}"

[ -f "/etc/smtpsender.conf" ] && . /etc/smtpsender.conf
[ -f "${HOME}/.config/smtpsender.conf" ] && . ${HOME}/.config/smtpsender.conf

echo "Send email notification"
echo "Configuration:"
echo "  SMTP_SERVER   = ${SMTP_SERVER}"
echo "  SMTP_USERNAME = ${SMTP_USERNAME}"
echo "  SENDER        = ${SENDER}"
echo "  RECEPIENT     = ${RECEPIENT}"
echo "  SUBJECT       = ${SUBJECT}"
smtpsender $@ --subject "${SUBJECT}"
if [ $? -eq 0 ]; then
    logger -s -t "$(basename "${0}")" "[OK] Send email to ${RECEPIENT}: ${SUBJECT}"
else
    logger -s -t "$(basename "${0}")" "[ERROR] Send email to ${RECEPIENT}: ${SUBJECT}"
fi
